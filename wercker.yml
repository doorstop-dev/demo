box: josh/python
build:
  steps:
    - flenter/py-virtualenv
    - script:
        name: create virtualenv
        code: make env
    - script:
        name: install package
        code: make
    - script:
        name: install dependencies
        code: make .depends-ci
    - script:
        name: run doorstop
        code: make doorstop
    - script:
        name: run unit tests
        code: make test
    - script:
        name: run integration tests
        code: make tests
deploy:
  steps:
    - script:
        name: install dependencies
        code: make .depends-dev
    - script:
        name: generate documentation
        code: make apidocs html
    - script:
        name: configure git
        code: |-
          git config --global user.email "pleasemailus@wercker.com"
          git config --global user.name "wercker"
          # remove current .git folder
          rm -rf .git
    - script:
        name: deploy to github pages
        code: |-
          cd docs/gen
          git init
          git add .
          git commit -m "deploy commit from $WERCKER_STARTED_BY"
          git push -f $GIT_REMOTE master:gh-pages
